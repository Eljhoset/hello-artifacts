name: Copy Artifact
on: [push]
env:
  SSH_AUTH_SOCK: /tmp/ssh_agent.sock
jobs:
  upload_artifact:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    name: Copy RPM using SSH
    steps:
      - id: checkout
        name: Checkout
        uses: actions/checkout@v3
      - name: Setup SSH passphrase
        env:
          SSH_PASSPHRASE: ${{secrets.SSH_PASSPHRASE}}
          SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
          SSH_HOST: ${{secrets.SSH_HOST}}
          SSH_PORT: ${{secrets.SSH_PORT}}
          SSH_USER: ${{secrets.SSH_USER}}
        run: |
          ssh-agent -a $SSH_AUTH_SOCK > /dev/null
          echo 'echo $SSH_PASSPHRASE' > ~/.ssh_askpass && chmod +x ~/.ssh_askpass
          echo "$SSH_PRIVATE_KEY" | tr -d '\r' | DISPLAY=None SSH_ASKPASS=~/.ssh_askpass ssh-add - >/dev/null           
